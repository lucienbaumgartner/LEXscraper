mailRefs <- remDr$findElements(using = "xpath", value = "//a[contains(text(), 'Mail')]")
ftable <- remDr$findElement(using = "xpath", value = "//table")
ftable
ftable$getElementAttribute("innerHTML")
ftable$getElementAttribute("innerHTML") %>% read_html()
ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table()
ftable$getElementAttribute("innerHTML")[[1]] %>% read_html()
ftable <- remDr$findElement(using = "xpath", value = "//table/tbody")
ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table()
ftable$getElementAttribute("innerHTML")[[1]] %>% read_html()
ftable <- remDr$findElement(using = "xpath", value = "//main[@id = 'main']")
ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table()
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table()
mailRefs
mailRefs[[1]]
mailRefs[[1]]$getActiveElement()
str(mailRefs)
mailRefs[[1]]
mailRefs[[1]]$getElementAttribute('value')
mailRefs[[1]]$getElementAttribute("href")
mailRefs[[1]]$clickElement()
remDr$screenshot(TRUE)
# get frames
frames <- remDr$findElements(using = "tag name", "frame")
frames
remDr$executeScript("arguments[0].click();", list(mailRefs[[1]]))
mail <- remDr$executeScript("arguments[0].click();", list(mailRefs[[1]]))
mail
mail <- remDr$executeScript("arguments[0].click();", list(mailRefs[[1]]))
ct <- v8()
read_html(ct$eval(gsub('document.write','',emailjs))) %>%
html_text()
remDr$close()
library(tidyverse)
library(rvest)
library(RSelenium)
rm(list = ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
writeLines(capture.output(sessionInfo()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_profile_scraper__session_info.txt")
remDr <- remoteDriver(
remoteServerAddr = "localhost",
port = 4444L,
browserName = "firefox"
)
remDr$open()
remDr$navigate()
writeLines(capture.output(remDr$getStatus()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_selenium__session_info.txt")
remDr$navigate("https://www.gl.ch/rechtspflege/anwaltsregister.html/276")
remDr$screenshot(TRUE)
remDr$getCurrentUrl()
# get table
ftable <- remDr$findElement(using = "xpath", value = "//main[@id = 'main']")
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table()
df
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table()[[1]]
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table() %>% unlist
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table()[1]
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table() %>% .[[1]]
# get mail buttons
pageRefs <- remDr$findElements(using = "xpath", value = "//a[contains(text(), 'www')]")
pageRefs[[1]]$clickElement()
remDr$screenshot(TRUE)
remDr$getWindowHandles()
remDr$switchToWindow(remDr$getWindowHandles()[[2]])
remDr$screenshot(TRUE)
remDr$close()
rm(list = ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
writeLines(capture.output(sessionInfo()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_profile_scraper__session_info.txt")
remDr <- remoteDriver(
remoteServerAddr = "localhost",
port = 4444L,
browserName = "firefox"
)
remDr$open()
remDr$navigate()
writeLines(capture.output(remDr$getStatus()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_selenium__session_info.txt")
remDr$navigate("https://www.gl.ch/rechtspflege/anwaltsregister.html/276")
remDr$getCurrentUrl()
# get table
ftable <- remDr$findElement(using = "xpath", value = "//main[@id = 'main']")
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table() %>% .[[1]]
mailRefs <- remDr$findElements(using = "xpath", value = "//a[contains(text(), 'Mail')]")
mailRefs
remDr$getWindowHandles()
pageRefs[[1]]$clickElement()
mailRefs[[1]]$clickElement()
remDr$getWindowHandles()
# get mail buttons
pageRefs <- remDr$findElements(using = "xpath", value = "//a[contains(text(), 'www')]")
pageRefs[[1]]$clickElement()
remDr$switchToWindow(remDr$getWindowHandles()[[2]])
remDr$screenshot(TRUE)
kPage <- remDr$findElement(using = "xpath", value = "//a[contains(text(), 'Kontakt')]")
kPage$clickElement()
remDr$screenshot(TRUE)
remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]")
l <- remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]")
l$getElementAttribute("innerHTML")
l$getElementAttribute("innerHTML")[[1]]
l <- remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]") %>% .$getElementAttribute("innerHTML")[[1]]
l <- remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]") %>% .$getElementAttribute("innerHTML")
l <- remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]")$getElementAttribute("innerHTML")
l
l <- remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]")$getElementAttribute("innerHTML")[[1]]
mail <- remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]")$getElementAttribute("innerHTML")[[1]]
remDr$closeWindow()
remDr$screenshot(TRUE)
remDr$close()
remDr$close()
library(tidyverse)
library(rvest)
library(RSelenium)
rm(list = ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
writeLines(capture.output(sessionInfo()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_profile_scraper__session_info.txt")
remDr <- remoteDriver(
remoteServerAddr = "localhost",
port = 4444L,
browserName = "firefox"
)
remDr$open()
remDr$navigate()
writeLines(capture.output(remDr$getStatus()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_selenium__session_info.txt")
remDr$navigate("https://www.gl.ch/rechtspflege/anwaltsregister.html/276")
remDr$getCurrentUrl()
# get table
ftable <- remDr$findElement(using = "xpath", value = "//main[@id = 'main']")
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table() %>% .[[1]]
# get mail buttons
pageRefs <- remDr$findElements(using = "xpath", value = "//a[contains(text(), 'www')]")
pageRefs[[1]]$clickElement()
remDr$switchToWindow(remDr$getWindowHandles()[[2]])
remDr$screenshot(TRUE)
remDr$findElement(using = "xpath", value = "//a[contains(text(), 'Kontakt')]")$clickElement()
remDr$screenshot(TRUE)
mail <- remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]")$getElementAttribute("innerHTML")[[1]]
remDr$closeWindow(remDr$getWindowHandles()[[2]])
remDr$getWindowHandles()
remDr$close()
remDr$screenshot(TRUE)
remDr
remDr$getCurrentUrl()
library(tidyverse)
library(rvest)
library(RSelenium)
rm(list = ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
writeLines(capture.output(sessionInfo()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_profile_scraper__session_info.txt")
remDr <- remoteDriver(
remoteServerAddr = "localhost",
port = 4444L,
browserName = "firefox"
)
remDr$open()
remDr$navigate()
writeLines(capture.output(remDr$getStatus()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_selenium__session_info.txt")
remDr$navigate("https://www.gl.ch/rechtspflege/anwaltsregister.html/276")
remDr$getCurrentUrl()
# get table
ftable <- remDr$findElement(using = "xpath", value = "//main[@id = 'main']")
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table() %>% .[[1]]
# get mail buttons
pageRefs <- remDr$findElements(using = "xpath", value = "//a[contains(text(), 'www')]")
pageRefs[[1]]$clickElement()
remDr$switchToWindow(remDr$getWindowHandles()[[2]])
remDr$screenshot(TRUE)
remDr$findElement(using = "xpath", value = "//a[contains(text(), 'Kontakt')]")$clickElement()
remDr$screenshot(TRUE)
mail <- remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]")$getElementAttribute("innerHTML")[[1]]
remDr$getWindowHandles()[[2]]
remDr$getWindowHandles()
remDr$switchToWindow(remDr$getWindowHandles()[[1]])
remDr$closeWindow()
remDr$screenshot(TRUE)
page <- read_html("https://www.gl.ch/rechtspflege/anwaltsregister.html/276")
df <- page %>% html_node(xpath = "//main[@id = 'main']") %>% html_table()
js <- page %>% html_node("script")
emailjs <- page %>% html_node(xpath = "//a[contains(text(), 'Mail')]") %>% html_attr("href")
df <- df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
)
df
df <- df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
web = gsub(".*(?=www\.)", "", mail)
)
df
df <- df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
web = gsub(".*(?=www\.)", "", mail)
)
df
df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
web = gsub(".*(?=www\.)", "", mail)
)
df <- df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
web = gsub(".*(?=www\\.)", "", mail)
)
df <- df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
web = gsub(".*(?=www)", "", mail)
)
df
df <- df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
web = gsub(".*(?=www\\.)", "", mail, perl = T)
)
df <- df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
web = str_extract(mail, "www.*")
)
df
page <- read_html("https://www.gl.ch/rechtspflege/anwaltsregister.html/276")
df <- page %>% html_node(xpath = "//main[@id = 'main']") %>% html_table()
js <- page %>% html_node("script")
df <- df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
web = str_extract(mail, "www.*")
)
df
container <. list()
container <- list()
.url <- paste0("https://", df$web, "/kontakt")
cpage <- try(read_html(.url))
.url
x <- df$web[1]
.url <- paste0("https://", x, "/kontakt")
cpage <- try(read_html(.url))
cpage
cpage %>% html_node(xpath = "//a[contains(href, 'mailto')]")
cpage %>% html_node(xpath = "//a[contains(@href, 'mailto')]")
cpage %>% html_node(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href")
cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href")
cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href") %>% gsub("mailto\\:", "", .)
mailinglist <- lapply(df$web, function(x){
#x <- df$web[1]
if(is.na(x)) return(NA)
.url <- paste0("https://", x, "/kontakt")
cpage <- try(read_html(.url))
if("try-error"%in%class(cpage)){return(x)}else{
mail <- cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href") %>% gsub("mailto\\:", "", .)
}
return(mail)
}
)
mailinglist
mailinglist <- lapply(df$web, function(x){
#x <- df$web[1]
if(is.na(x)) return(NA)
.url <- c(paste0("https://", x, "/kontakt"), paste0("https://", x, "/kontakt.html"),
paste0("https://", x, "/contact"), paste0("https://", x, "/contact.html"))
sublist <- sapply(
.url, function(y){
cpage <- try(read_html(.url))
if("try-error"%in%class(cpage)){
return(x)
}else{
mail <- cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href") %>% gsub("mailto\\:", "", .) %>% unique
}
return(mail)
}
)
sublist <- unique(unlist(sublist))
return(sublist)
}
)
mailinglist <- lapply(df$web, function(x){
#x <- df$web[1]
if(is.na(x)) return(NA)
.url <- c(paste0("https://", x, "/kontakt"), paste0("https://", x, "/kontakt.html"),
paste0("https://", x, "/contact"), paste0("https://", x, "/contact.html"))
sublist <- sapply(
.url, function(y){
cpage <- try(read_html(y))
if("try-error"%in%class(cpage)){
return(y)
}else{
mail <- cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href") %>% gsub("mailto\\:", "", .) %>% unique
}
return(mail)
}
)
sublist <- unique(unlist(sublist))
return(sublist)
}
)
mailinglist
mailinglist <- lapply(df$web, function(x){
#x <- df$web[1]
if(is.na(x)) return(NA)
.url <- c(paste0("https://", x, "/kontakt"), paste0("https://", x, "/kontakt.html"),
paste0("https://", x, "/contact"), paste0("https://", x, "/contact.html"))
sublist <- sapply(
.url, function(y){
cpage <- try(read_html(y))
if("try-error"%in%class(cpage)){
return(NULL)
}else{
mail <- cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href") %>% gsub("mailto\\:", "", .) %>% unique
if(is.na(mail)|identical(mail, character(0))) mail <- cpage %>% html_nodes(xpath = "//[contains(text(), '@')]") %>% html_text("href") %>% unique
return(mail)
}
}
)
sublist <- unique(unlist(sublist))
return(sublist)
}
)
mailinglist <- lapply(df$web, function(x){
#x <- df$web[1]
if(is.na(x)) return(NA)
.url <- c(paste0("https://", x, "/kontakt"), paste0("https://", x, "/kontakt.html"),
paste0("https://", x, "/contact"), paste0("https://", x, "/contact.html"))
sublist <- sapply(
.url, function(y){
cpage <- try(read_html(y))
if("try-error"%in%class(cpage)){
return(NULL)
}else{
mail <- cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href") %>% gsub("mailto\\:", "", .) %>% unique
if(length(mail <= 1)){
if(is.na(mail)|identical(mail, character(0))) mail <- cpage %>% html_nodes(xpath = "//[contains(text(), '@')]") %>% html_text("href") %>% unique
}
return(mail)
}
}
)
sublist <- unique(unlist(sublist))
return(sublist)
}
)
mailinglist <- lapply(df$web, function(x){
#x <- df$web[1]
if(is.na(x)) return(NA)
.url <- c(paste0("https://", x, "/kontakt"), paste0("https://", x, "/kontakt.html"),
paste0("https://", x, "/contact"), paste0("https://", x, "/contact.html"))
sublist <- sapply(
.url, function(y){
cpage <- try(read_html(y))
if("try-error"%in%class(cpage)){
return(NULL)
}else{
mail <- cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href") %>% gsub("mailto\\:", "", .) %>% unique
if(length(mail) <= 1){
if(is.na(mail)|identical(mail, character(0))) mail <- cpage %>% html_nodes(xpath = "//[contains(text(), '@')]") %>% html_text("href") %>% unique
}
return(mail)
}
}
)
sublist <- unique(unlist(sublist))
return(sublist)
}
)
mailinglist <- lapply(df$web, function(x){
#x <- df$web[1]
if(is.na(x)) return(NA)
.url <- c(paste0("https://", x, "/kontakt"), paste0("https://", x, "/kontakt.html"),
paste0("https://", x, "/contact"), paste0("https://", x, "/contact.html"))
sublist <- sapply(
.url, function(y){
cpage <- try(read_html(y))
if("try-error"%in%class(cpage)){
return(NULL)
}else{
mail <- cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href") %>% gsub("mailto\\:", "", .) %>% unique
if(length(mail) <= 1){
if(is.na(mail)|identical(mail, character(0))){m
mail <- try(cpage %>% html_nodes(xpath = "//[contains(text(), '@')]") %>% html_text("href")%>% unique)
if("try-error"%in%class(cpage)) return(NULL)
}
}
return(mail)
}
}
)
sublist <- unique(unlist(sublist))
return(sublist)
}
)
mailinglist <- lapply(df$web, function(x){
#x <- df$web[1]
if(is.na(x)) return(NA)
.url <- c(paste0("https://", x, "/kontakt"), paste0("https://", x, "/kontakt.html"),
paste0("https://", x, "/contact"), paste0("https://", x, "/contact.html"))
sublist <- sapply(
.url, function(y){
cpage <- try(read_html(y))
if("try-error"%in%class(cpage)){
return(NULL)
}else{
mail <- cpage %>% html_nodes(xpath = "//a[contains(@href, 'mailto')]") %>% html_attr("href") %>% gsub("mailto\\:", "", .) %>% unique
if(length(mail) == 1){
if(is.na(mail)|identical(mail, character(0))){
mail <- try(cpage %>% html_nodes(xpath = "//[contains(text(), '@')]") %>% html_text("href")%>% unique)
if("try-error"%in%class(cpage)) return(NULL)
}
}
return(mail)
}
}
)
sublist <- unique(unlist(sublist))
return(sublist)
}
)
mailinglist
#x <- df$web[31]
if(is.na(x)) return(NA)
x <- df$web[31]
try(read_html(paste0("https://", x)) %>% html_nodes(xpath = "//[contains(text(), '@')]") %>% html_text("href")%>% unique)
read_html(paste0("https://", x))
read_html(paste0("https://", x)) %>% html_nodes(xpath = "//*[contains(text(), '@')]")
paste0("https://", x)
library(tidyverse)
library(rvest)
library(RSelenium)
rm(list = ls())
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
writeLines(capture.output(sessionInfo()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_profile_scraper__session_info.txt")
remDr <- remoteDriver(
remoteServerAddr = "localhost",
port = 4444L,
browserName = "firefox"
)
remDr$open()
remDr$navigate()
remDr$open()
writeLines(capture.output(remDr$getStatus()), "/Volumes/extICY/LEXscraping/anwaltsregister_CH/res/session_infos/GL_selenium__session_info.txt")
remDr$navigate("https://www.gl.ch/rechtspflege/anwaltsregister.html/276")
remDr$getCurrentUrl()
remDr$getCurrentUrl()
# get table
ftable <- remDr$findElement(using = "xpath", value = "//main[@id = 'main']")
df <- ftable$getElementAttribute("innerHTML")[[1]] %>% read_html() %>% html_table() %>% .[[1]]
df <- df %>%
setNames(., c("address", "tel", "fax", "mail")) %>%
mutate(
name = gsub("\\,.*", "", address),
web = str_extract(mail, "www.*")
)
df
# get mail buttons
pageRefs <- remDr$findElements(using = "xpath", value = "//a[contains(text(), 'www')]")
i = 1
i = 1
pageRefs[[i]]$clickElement()
remDr$switchToWindow(remDr$getWindowHandles()[[2]]) # go to new window
remDr$screenshot(TRUE)
remDr$findElement(using = "xpath", value = "//a[matches(text(), '(K|k)ontakt|(C|c)ontact')]")$clickElement()
remDr$findElement(using = "xpath", value = "//a[contains(text(), '(K|k)ontakt|(C|c)ontact')]")$clickElement()
remDr$findElement(using = "xpath", value = "//a[contains(text(), 'Kontakt')]")$clickElement()
cpage <- remDr$findElement(using = "xpath", value = "//a[contains(text(), 'Kontakt')]")$clickElement()
remDr$screenshot(TRUE)
mail <- remDr$findElement(using = "xpath", value = "//a[contains(@href, 'mailto')]")$getElementAttribute("innerHTML")[[1]]
remDr$findElement("//*[contains(text(), '@')]")
remDr$findElement(using = "xpath", value = "//*[contains(text(), '@')]")
mail <- remDr$findElement(using = "xpath", value = "//*[contains(text(), '@')]")
mail <- try(remDr$findElement(using = "xpath", value = "//*[contains(text(), '@')]")$getElementAttribute("innerHTML")[[1]])
mail <- try(remDr$findElement(using = "xpath", value = "//*[contains(@href, 'mailto') OR contains(text(), '@')]")$getElementAttribute("innerHTML")[[1]])
mail <- try(remDr$findElement(using = "xpath", value = "//*[contains(@href, 'mailto') or contains(text(), '@')]")$getElementAttribute("innerHTML")[[1]])
container[[i]] <- ifelse("try-error"%in%class(mail), NA, mail)
remDr$switchToWindow(remDr$getWindowHandles()[[1]]) # go back to initial window
remDr$closeWindow() # close all other windows
remDr$screenshot(TRUE)
emDr$screenshot(TRUE)
mail <- try(remDr$findElement(using = "xpath", value = "//*[contains(@href, 'mailto') or contains(text(), '@')]")$getElementAttribute("innerHTML")[[1]])
container[[i]] <- ifelse("try-error"%in%class(mail), NA, mail)
remDr$switchToWindow(remDr$getWindowHandles()[[1]]) # go back to initial window
for(i in 1:length(pageRefs)){
i = 1
pageRefs[[i]]$clickElement()
remDr$switchToWindow(remDr$getWindowHandles()[[i+1]]) # go to new window
remDr$screenshot(TRUE)
cpage <- try(remDr$findElement(using = "xpath", value = "//a[contains(text(), 'Kontakt') or contains(text(), 'Contact') or contains(text(), 'Impressum')]"))
if("try-error"%in%class(mail)){
mail <- try(remDr$findElement(using = "xpath", value = "//*[contains(@href, 'mailto') or contains(text(), '@')]")$getElementAttribute("innerHTML")[[1]])
container[[i]] <- ifelse("try-error"%in%class(mail), NA, mail)
}
cpage$clickElement()
r
emDr$screenshot(TRUE)
mail <- try(remDr$findElement(using = "xpath", value = "//*[contains(@href, 'mailto') or contains(text(), '@')]")$getElementAttribute("innerHTML")[[1]])
container[[i]] <- ifelse("try-error"%in%class(mail), NA, mail)
remDr$switchToWindow(remDr$getWindowHandles()[[1]]) # go back to initial window
}
